
## Что такое пирамида?

>[!INFO]
>##### Пирамида — это полное двоичное дерево, удовлетворяющее главное свойство: 
>>Любой родительский узел по значению ключа всегда ≥ ключа узла его потомка. 

%%Это определение для max-heap - одного из двух видов пирамид%%

Куча всегда представляет собой полное двоичное дерево, что означает:

- Все уровни полностью заполнены, за исключением, возможно, последнего уровня
    
- Последний уровень заполняется слева направо

Это свойство гарантирует, что дерево остается сбалансированным, что имеет решающее значение для поддержания эффективности операций с кучей

Существуют также пирамиды, где значение в любой вершине, наоборот, не больше, чем значения её потомков. Такие кучи называются min-heap. В дальнейшем пусть рассматривается только max-heap. Все алгоритмы и свойства min-heap осуществляются аналогично 


Кучи удобно хранить в массивах, поскольку они являются полными бинарными деревьями. Такое представление позволяет легко вычислять родительские и дочерние индексы с помощью простой арифметики. 

В таком массиве m:

`m[0]` - корень пирамиды, в котором хранится максимальное (минимальное) значение пирамиды;

В то же время для любого элемента кучи `m[i]`:

`m[i * 2 + 1]` - левый потомок
`m[i * 2 + 2]` - правый потомок
`m[(i - 1) / 2]` - родитель

При таком способе хранения вышеописанные два свойства будут выполняться автоматически.

## Разновидность пирамид

Повторим ещё раз, что для структуры двоичной кучи есть два вида:

- **max-heap**, для которой любой узел всегда **больше** дочернего узла (узлов), а ключ корневого узла является **наибольшим** среди всех остальных узлов;

![[Pasted image 20241224123151.png]]
```
m[9, 5, 4, 1, 3, 2]

Для m[1] (5):

m[3] - 1 - левый потомок
m[4] - 3 - правый потомок
```


- И **min-heap**, где уже ключ корневого узла является **наименьшим** среди всех остальных узлов, а любой узел всегда **меньше** дочернего узла (узлов)**

![[min-heap.png]]
```
m[1, 2, 3, 4, 5, 9]

Для m[1] (2):

m[3] - 4 - левый потомок
m[4] - 5 - правый потомок
```


## Вспомогательные методы SiftUp and Heapify

Прежде чем мы перейдём непосредственно к стандартным операциям в структуре кучи, хотелось бы остановиться на двух вспомогательных методах структуры, которые позволяют менять значения потомков с родителям. 

Это методы:

- #### SiftUp

     Данный метод "двигает вверх" элемент по уровням кучи, пока его значение больше  (для min-heap, соответственно, меньше) своего предка

- #### SiftDown (или Heapify)

     Аналогично предыдущему методу, SiftDown "опускает" элемент до тех пор, пока его значения меньше (больше) одного из двух потомков. Данная процедура восстанавливает свойство кучи в дереве, у которого левое и правое поддеревья удовлетворяют ему.


## Основные операции в пирамиде

Теперь разберём принцип и алгоритм работы основных операций в пирамиде :

%%Для min-heap, всё симметрично%%

- #### Insert

     При вставке добавляется новый элемент к концу массива, а затем вызывается метод ранее упомянутый SiftUp, если, конечно, после вставки нового узла свойство пирамиды было нарушено 
     ![[Heap_Insertion.mp4]]


- #### Delete

     При удалении определённого узла из структуры он заменяется крайним вставленным узлом в структуре, и дальше, как и в предыдущем пункте при нарушении свойства, вызывается восстанавливающая процедура Heapify


- #### Extract max(min) 

     Данная операция идентична предыдущей, однако здесь мы меняем местами наибольший ключ в массиве (то есть, `M[0]`) с `M[size - 1]`
     ![[Heap_Deletion.mp4]]


- #### Peek

     Данный метод возвращает значение максимального элемента в пирамиде


>[!INFO]
>Сложность основных функций:
>- Добавить элемент в кучу - O(log⁡n)
>- Исключить максимальный элемент из кучи - O(log⁡n)
>- Изменить значение любого элемента. Время работы - O(log⁡n)



